<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>El SÃ³tano del Doctor</title>
    <link rel="icon" href="assets/favicon_el_sotano_dr.ico" type="image/x-icon">
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #111;
            padding: 20px;
            text-align: center;
        }
        header img {
            width: 300px;
            height: auto;
        }
        main {
            padding: 20px;
        }
        section {
            margin-bottom: 50px;
            padding: 20px;
            background-color: #111;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
        }
        h2 {
            border-bottom: 2px solid #0cf;
            color: #0cf;
            padding-bottom: 10px;
            font-size: 1.8em;
            text-align: center;
        }
        p {
            color: #aaa;
            font-size: 1em;
            line-height: 1.5;
            text-align: center;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            color: #fff;
            font-size: 0.95em;
        }
        thead {
            background-color: #222;
            color: #0cf;
        }
        th, td {
            padding: 12px;
            border: 1px solid #333;
            text-align: left;
        }
        tr:nth-child(even) {
            background-color: #1a1a1a;
        }
        #download-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 1em;
            background-color: #0cf;
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        footer {
            background-color: #111;
            color: #888;
            text-align: center;
            padding: 20px;
            font-size: 0.9em;
            border-top: 1px solid #222;
        }
    </style>
</head>
<body>
    <header>
        <img src="assets/logo_blanco.png" alt="El SÃ³tano del Doctor logo" />
    </header>
    <main>
        <section id="setlists">
            <h2>ðŸŽ¼ Setlists Ensayos 2025 ðŸŽ¶</h2>
            <p>Consulta los setlists en tiempo real desde BandHelper:</p>
            <table>
                <thead>
                    <tr>
                        <th>TÃ­tulo</th>
                        <th>Tonalidad</th>
                        <th>Tempo</th>
                        <th>DuraciÃ³n</th>
                    </tr>
                </thead>
                <tbody id="setlist-body"></tbody>
            </table>
            <button id="download-btn">ðŸ“¥ Descargar PDF del setlist</button>
            <p style="margin-top:10px; font-size: 0.9em; color: #888;">ðŸŽ§ Setlist actualizado en tiempo real desde la app</p>
        </section>

<section id="Calendario de Actuaciones" style="text-align: center; margin-top: 50px;">
  <h2 style="color: #0cf;">ðŸ“… PrÃ³ximos conciertos</h2>
  <p style="color: #aaa;">Consulta nuestro calendario actualizado desde BandHelper</p>
  <button onclick="abrirModal()" style="padding: 10px 20px; margin-top: 10px; font-size: 1em; background-color: #0cf; color: #000; border: none; border-radius: 8px; cursor: pointer;">
    ðŸ“… Ver calendario de conciertos
  </button>
</section>

<!-- MODAL -->
<div id="modalCalendario" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background-color: rgba(0,0,0,0.8); z-index: 1000; justify-content: center; align-items: center;">
  <div style="background-color: #fff; padding: 30px; border-radius: 10px; max-width: 800px; width: 90%; position: relative;">
    <button onclick="cerrarModal()" style="position: absolute; top: 10px; right: 15px; background: #0cf; color: #000; border: none; font-size: 1.2em; padding: 5px 10px; border-radius: 5px; cursor: pointer;">âœ–</button>
    <h3 style="color: #000; margin-top: 0;">Calendario de conciertos</h3>
    <div style="overflow-x: auto;">
      <script type="text/javascript" src="https://www.bandhelper.com/widget/calendar/10353?range=6"></script>
    </div>
  </div>
</div>

<script>
  function abrirModal() {
    document.getElementById("modalCalendario").style.display = "flex";
  }
  function cerrarModal() {
    document.getElementById("modalCalendario").style.display = "none";
  }
</script>


    </main>
    <footer>
        Â© 2025 El SÃ³tano del Doctor. Todos los derechos reservados.
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        const url = 'https://cold-limit-811a.jagomezc.workers.dev';

        async function cargarSetlist() {
            try {
                const res = await fetch(url);
                const data = await res.json();
                const tbody = document.getElementById('setlist-body');
                tbody.innerHTML = '';
                const songs = data.filter(item => item.type === 'song');
                songs.forEach(song => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${song.name || ''}</td>
                        <td>${song.key || ''}</td>
                        <td>${song.tempo || ''}</td>
                        <td>${song.duration || ''}</td>
                    `;
                    tbody.appendChild(row);
                });
                return songs;
            } catch (err) {
                console.error('Error al cargar el setlist:', err);
                document.getElementById('setlist-body').innerHTML = '<tr><td colspan="4">Error al cargar el setlist.</td></tr>';
                return [];
            }
        }

        async function descargarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(14);
            doc.text("Setlist - El SÃ³tano del Doctor", 20, 20);

            const songs = await cargarSetlist();

            const columns = ["TÃ­tulo", "Tonalidad", "Tempo", "DuraciÃ³n"];
            const rows = songs.map(s => [s.name || '', s.key || '', s.tempo || '', s.duration || '']);

            doc.autoTable({
                head: [columns],
                body: rows,
                startY: 30,
                styles: { halign: 'left' },
                headStyles: { fillColor: [0, 255, 255], textColor: 0 }
            });

            doc.save("setlist_ElSotanoDelDoctor.pdf");
        }

        document.getElementById('download-btn').addEventListener('click', descargarPDF);

        cargarSetlist();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
</body>
</html>
